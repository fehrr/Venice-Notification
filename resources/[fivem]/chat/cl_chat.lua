-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
vRP = Proxy.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
cRP = {}
Tunnel.bindInterface("chat",cRP)

-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-----------------------------------------------------------------------------------------------------------------------------------------
local chatOpen = false
local chatActive = true
RegisterNetEvent('chat:clear')



-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("chatMessage")
AddEventHandler("chatMessage",function(author,color,text,type)
	if LocalPlayer.state.in_arena_event then
		return
	end


	if chatActive then
		local args = { text }
		if author ~= "" then
			args = { author, text }
		end

		SendNUIMessage({ type = "ON_MESSAGE", message = { color = color, multiline = true, args = args, type = type or 'mensagem' } })
		SendNUIMessage({ type = "ON_SCREEN_STATE_CHANGE", shouldHide = false })
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- ADDMESSAGE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("chat:addMessage")
AddEventHandler("chat:addMessage",function(message)
	if LocalPlayer.state.in_arena_event then
		return
	end

	SendNUIMessage({ type = "ON_MESSAGE", message = message })
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CLEAR
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("chat:clear")
AddEventHandler("chat:clear",function(name)
	SendNUIMessage({ type = "ON_CLEAR" })
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CLEARSUGGESTIONS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("chat:clearSuggestions")
AddEventHandler("chat:clearSuggestions",function()
	SendNUIMessage({ type = "ON_SUGGESTIONS_REMOVE" })
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHATRESULT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("chatResult",function(data,cb)
	SetNuiFocus(false)
	if data.message then
		if data.message:sub(1,1) == "/" then
			ExecuteCommand(data.message:sub(2))
		else
			TriggerServerEvent("chat:messageEntered",data.message)
			-- ExecuteCommand("me ".. data.message)
		end
	end
	cb("ok")
end)


-----------------------------------------------------------------------------------------------------------------------------------------
-- ADDSUGGESTION
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("chat:addSuggestion")
AddEventHandler("chat:addSuggestion",function(suggestions)
	for _,suggestion in ipairs(suggestions) do
		SendNUIMessage({
			type = 'ON_SUGGESTION_ADD',
			suggestion = suggestion
		})
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- LOADED
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("loaded",function(data,cb)
	cb("ok")
end)

AddEventHandler('chat:clear', function(name)
	SendNUIMessage({
	  type = 'ON_CLEAR'
	})
  end)

RegisterNetEvent("chat:handleDisable")
AddEventHandler("chat:handleDisable",function()
	SetNuiFocus(false,false)
	SendNUIMessage({ type = "MARS_TESTE" })
end)
  
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHAT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterCommand("dchat",function(source,args)
	if chatOpen then
		if chatActive then
			chatActive = false
			SendNUIMessage({ type = "MARS_TESTE" })
		else
			chatActive = true
			SendNUIMessage({ type = "MARS_LINDO" })
		end
	end
end)

-----------------------------------------------------------------------------------------------------------------------------------------
-- THREADSTART
-----------------------------------------------------------------------------------------------------------------------------------------
CreateThread(function()
	SetTextChatEnabled(false)
	SetNuiFocus(false)
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- OPENCHAT
-----------------------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------------------------
-- COMMAND
-----------------------------------------------------------------------------------------------------------------------------------------
 RegisterKeyMapping("openChat2","Abrir chat","keyboard","t")

 RegisterCommand("openChat2",function()
	if LocalPlayer.state.in_arena_event then
		return
	end

	chatOpen = true
	SetNuiFocus(true, true)
	SendNUIMessage({ type = "ON_OPEN" })
	SendNUIMessage({ type = "MARS_LINDO" })
	chatActive = true
end)

-----------------------------------------------------------------------------------------------------------------------------------------
-- STATUSCHAT
-----------------------------------------------------------------------------------------------------------------------------------------
function cRP.statusChat()
	return chatOpen
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- STATUSCHAT
-----------------------------------------------------------------------------------------------------------------------------------------
function statusChat()
	return chatOpen
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- EXPORTS
-----------------------------------------------------------------------------------------------------------------------------------------
-- exports("statusChat",statusChat)



